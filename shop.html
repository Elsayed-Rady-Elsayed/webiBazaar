<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
    <div id="backHome" class="btn btn-warning rounded rounded-5 text-light position-fixed end-0 bottom-0 m-5">
        back
    </div>
    <div id="showProduct" class="container row m-auto pt-5"></div>
    <script>
 
        document.getElementById("backHome").onclick = function () { 
            history.back();
         }
        function getParams() {
            const params = {};
            const queryString = window.location.search.substring(1); // This gets the part after '?' in the URL
            const urlParams = new URLSearchParams(queryString);

            urlParams.forEach((value, key) => {
                params[key] = value;
            });
            console.log(params);
            return params;
        }
        function updateProductDetails() {
        const params = getParams();
        const productContent = document.getElementById('showProduct');
        if (params.id && params.name && params.img && params.price) {
            productContent.innerHTML = `
        <div class="col-12 align-items-center justify-content-center col-md-4">
            <img src="${params.img}" class="img-thumbnail w-100" alt="">
        </div>
        <div class="right col-12 col-md-8 d-flex flex-column h-100 justify-content-between ">
        <h3 class="text-capitalize fw-bold fs-2">${params.name}</h3>
        <hr>
        <h5 class="fs-3 fw-semibold">$${params.price}</h5>
        <hr>
        <p class="text-secondary">Lorem ipsum dolor sit amet consectetur adipisicing elit. Dicta suscipit ullam quibusdam voluptatum tenetur, rerum aspernatur! Placeat soluta consequuntur repellat, ex, earum ipsa velit eaque, asperiores delectus illum possimus natus.</p>
        <hr>
        <div class="quntity d-flex w-100 justify-content-between align-items-center">
          <div class="select w-75">
            <div class="btn btn-warning text-light">+</div>
            <div class="btn w-25 border border-1 border-warning">0</div>
            <div class="btn btn-warning text-light">-</div>
          </div>
          <div class="price fw-bold">
            price: <span class="text-warning">$578</span>
          </div>
        </div>
        <hr>
        <div data-bs-pid="${params.id}" class="btn btn-warning text-light w-50 addToCart" id='addToCart'>add to cart</div>
        <div data-bs-pid="${params.id}" class="btn btn-danger text-light w-50 addToCartWishes mt-2" id='addToCartWishes'>add to wishlist</div>
      </div>
      <ul class="nav nav-tabs mt-5" id="ProductsTap" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="DESCRIPTION-tab" data-bs-toggle="tab" data-bs-target="#DESCRIPTION-tab-pane" type="button" role="tab" aria-controls="DESCRIPTION-tab-pane" aria-selected="true">DESCRIPTION</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="ADDITIONAL-tab" data-bs-toggle="tab" data-bs-target="#ADDITIONAL-tab-pane" type="button" role="tab" aria-controls="ADDITIONAL-tab-pane" aria-selected="false">
            ADDITIONAL INFORMATION</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="REVIEWS-tab" data-bs-toggle="tab" data-bs-target="#REVIEWS-tab-pane" type="button" role="tab" aria-controls="REVIEWS-tab-pane" aria-selected="false">REVIEWS</button>
        </li>
      </ul>
      <div class="tab-content border border-1 mb-4" id="myTabContent">
        <div class="tab-pane fade show active" id="DESCRIPTION-tab-pane" role="tabpanel" aria-labelledby="DESCRIPTION-tab" tabindex="0">
          <p class="text-capitalize fw-semibold text-dark mt-3">Paragraph text</p>
          <p class="text-secondary">Nam tristique porta ligula, vel viverra sem eleifend nec. Nulla sed purus augue, eu euismod tellus. Nam mattis eros nec mi sagittis sagittis. Vestibulum suscipit cursus bibendum. Integer at justo eget sem auctor auctor eget vitae arcu. Nam tempor malesuada porttitor. Nulla quis dignissim ipsum. Aliquam pulvinar iaculis justo, sit amet interdum sem hendrerit vitae. Vivamus vel erat tortor. Nulla facilisi. In nulla quam, lacinia eu aliquam ac, aliquam in nisl.</p>
          <ul class="mb-4">
            <li class="text-secondary">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</li>
            <li class="text-secondary">Maecenas ullamcorper est et massa mattis condimentum.</li>
            <li class="text-secondary">Vestibulum sed massa vel ipsum imperdiet malesuada id tempus nisl.</li>
            <li class="text-secondary">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</li>
            <li class="text-secondary">Mauris eget diam magna, in blandit turpis.</li>
          </ul>
          <ol class="mb-4">
            <li class="text-secondary">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</li>
            <li class="text-secondary">Maecenas ullamcorper est et massa mattis condimentum.</li>
            <li class="text-secondary">Vestibulum sed massa vel ipsum imperdiet malesuada id tempus nisl.</li>
            <li class="text-secondary">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</li>
            <li class="text-secondary">Mauris eget diam magna, in blandit turpis.</li>
          </ol>
          <p class="text-secondary">
            In cursus faucibus tortor eu vestibulum. Ut eget turpis ac justo porta varius. Donec vel felis ante, ac vehicula ipsum. Quisque sed diam metus. Quisque eget leo sit amet erat varius rutrum vitae dapibus lectus. Vivamus et sapien ante. Suspendisse potenti. Fusce in tellus est, ac consequat lacus. Nulla risus massa, commodo in imperdiet ut, ornare in leo. Duis pellentesque sagittis lorem, sed mollis lorem venenatis id.
          </p>
        </div>
        <div class="tab-pane fade p-2" id="ADDITIONAL-tab-pane" role="tabpanel" aria-labelledby="ADDITIONAL-tab" tabindex="0">
          <p class="text-capitalize fw-semibold text-dark mt-3">
            ADDITIONAL INFORMATION
          </p>
          <div class="additional border border-1 my-5">
            <div class="ite1 d-flex align-items-center p-2 h-100">
              <p class="fw-bold me-5 text-dark">weight</p>
              <p class="text-secondary">15kg</p>
            </div>
            <hr class="text-dark p-0 m-0">
            <div class="ite1 d-flex align-items-center h-100 p-2">
              <p class="fw-bold me-5 text-dark">Dimensions</p>
              <p class="text-secondary">124 × 451 × 215 cm</p>
            </div>
          </div>
        </div>
        <div class="tab-pane fade p-2" id="REVIEWS-tab-pane" role="tabpanel" aria-labelledby="REVIEWS-tab" tabindex="0">
          <p class="text-capitalize fw-semibold text-dark mt-3">
            REVIEWS
          </p>
          <div class="rev mb-4">
            no reviews yet
          </div>
          <form>
            <div class="mb-3">
              <label for="" class="form-label">Email address</label>
              <input type="email" class="form-control" id="" aria-describedby="emailHelp">
              <div id="emailHelp" class="form-text">We'll never share your email with anyone else.</div>
            </div>
            <div class="mb-3">
              <label for="" class="form-label">Name</label>
              <input type="text" class="form-control" id="" aria-describedby="emailHelp">
            </div>
            <div class="mb-3">
              <label for="" class="form-label">Review</label>
              <textarea name="" rows="7" class="form-control" id=""></textarea>
            </div>
            <button type="submit" class="btn btn-warning text-light">Submit</button>
          </form>
        </div>
      </div>
            `;
        } else {
          // history.back();
        }

    }
        window.addEventListener('hashchange', updateProductDetails);
        updateProductDetails();
        function addToCartOrWishList(elment) {
            const user = JSON.parse(window.localStorage.getItem("user"));

            const apiUrl = "http://localhost:3000/";

        document.querySelector(elment).addEventListener("click",function(ev){
        if(ev.target.classList.contains("addToCart")){
          console.log("add to cart");
          user.cart.push(Number(ev.target.getAttribute("data-bs-pid")));
        }if(ev.target.classList.contains("addToCartWishes")){
            console.log(ev.target.getAttribute("data-bs-pid"));
            user.wishlist.push(Number(ev.target.getAttribute("data-bs-pid")));
          
        }
        const data = {
            id: user.id,
            name: user.name,
            email: user.email,
            status: user.status,
            password: user.pass,
            cart: user.cart,
            wishlist: user.wishlist
        };
        const options = {
            method: "PUT",
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        };
        fetch(`${apiUrl}user/${user.id}`, options)
          .then(response => {
              if (response.ok) {
                  return response.json();
              } else {
                  throw new Error("Problem occurred: " + response.statusText);
              }
          })
          .then(data => {
              console.log("Success:", data);
          })
          .catch(error => {
              console.error("Error:", error);
          });
        window.localStorage.setItem("user",JSON.stringify(user));  
        console.log(user);
      });
    }
    if(window.localStorage.getItem("isLogined")){
        addToCartOrWishList("#addToCart");
        addToCartOrWishList("#addToCartWishes");
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
</body>
</html>